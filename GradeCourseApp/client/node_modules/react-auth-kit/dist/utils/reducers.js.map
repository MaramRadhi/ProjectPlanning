{"version":3,"file":"reducers.js","sources":["../../src/utils/reducers.ts"],"sourcesContent":["/**\n * @author Arkadip Bhattacharya <in2arkadipb13@gmail.com>\n * @fileoverview Reducers for useReducer\n * @copyright Arkadip Bhattacharya 2020\n *\n * Copyright 2020 Arkadip Bhattacharya\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *         http://www.apache.org/licenses/LICENSE-2.0\n *\n *  Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport {AuthKitStateInterface} from '../types';\nimport {\n  ActionType,\n  AuthActions,\n  SignInAction,\n  SignInActionPayload,\n  SignOutAction,\n  RefreshTokenAction,\n  RefreshTokenActionPayload,\n} from './actions';\n\n/**\n * Auth Reducer\n * Used in auth state\n * @param state\n * @param action\n */\nexport function authReducer(state: AuthKitStateInterface,\n    action: AuthActions)\n  : AuthKitStateInterface {\n  switch (action.type) {\n    case ActionType.SignIn:\n      return {\n        ...state,\n        auth: action.payload.auth,\n        refresh: action.payload.refresh,\n        userState: action.payload.userState,\n        isSignIn: true,\n      };\n    case ActionType.SignOut:\n      return {\n        ...state,\n        auth: null,\n        refresh: null,\n        userState: null,\n        isSignIn: false,\n      };\n    case ActionType.RefreshToken:\n      if (state.isSignIn && state.auth && state.refresh) {\n        return {\n          ...state,\n          auth: {\n            token: action.payload.newAuthToken ?\n              action.payload.newAuthToken : state.auth.token,\n            type: state.auth.type,\n            expiresAt: action.payload.newAuthTokenExpireIn ?\n              new Date(new Date().getTime() +\n                action.payload.newAuthTokenExpireIn * 60 * 1000) :\n              state.auth.expiresAt,\n          },\n          refresh: {\n            token: action.payload.newRefreshToken ?\n              action.payload.newRefreshToken : state.refresh.token,\n            expiresAt: action.payload.newRefreshTokenExpiresIn ?\n              new Date(new Date().getTime() +\n                action.payload.newRefreshTokenExpiresIn * 60 * 1000) :\n              state.refresh.expiresAt,\n          },\n          userState: action.payload.newAuthUserState ?\n            action.payload.newAuthUserState : state.userState,\n        };\n      } else {\n        return state;\n      }\n  }\n}\n\n// Helper functions\n/**\n * used to make sign in\n * @param signInParams\n */\nexport function doSignIn(signInParams: SignInActionPayload): SignInAction {\n  return ({\n    type: ActionType.SignIn,\n    payload: signInParams,\n  });\n}\n\n/**\n * used to refresh the Token\n * @param refreshTokenParam\n */\nexport function doRefresh(refreshTokenParam: RefreshTokenActionPayload):\n  RefreshTokenAction {\n  return ({\n    type: ActionType.RefreshToken,\n    payload: refreshTokenParam,\n  });\n}\n\n/**\n * Used to make sign out\n */\nexport function doSignOut(): SignOutAction {\n  return ({\n    type: ActionType.SignOut,\n  });\n}\n"],"names":[],"mappings":";;;AA8BA;;;;;AAKG;AACa,SAAA,WAAW,CAAC,KAA4B,EACpD,MAAmB,EAAA;IAErB,QAAQ,MAAM,CAAC,IAAI;QACjB,KAAK,UAAU,CAAC,MAAM;AACpB,YAAA,OAAA,QAAA,CAAA,QAAA,CAAA,EAAA,EACK,KAAK,CAAA,EAAA,EACR,IAAI,EAAE,MAAM,CAAC,OAAO,CAAC,IAAI,EACzB,OAAO,EAAE,MAAM,CAAC,OAAO,CAAC,OAAO,EAC/B,SAAS,EAAE,MAAM,CAAC,OAAO,CAAC,SAAS,EACnC,QAAQ,EAAE,IAAI,EACd,CAAA,CAAA;QACJ,KAAK,UAAU,CAAC,OAAO;AACrB,YAAA,OAAA,QAAA,CAAA,QAAA,CAAA,EAAA,EACK,KAAK,CACR,EAAA,EAAA,IAAI,EAAE,IAAI,EACV,OAAO,EAAE,IAAI,EACb,SAAS,EAAE,IAAI,EACf,QAAQ,EAAE,KAAK,EACf,CAAA,CAAA;QACJ,KAAK,UAAU,CAAC,YAAY;YAC1B,IAAI,KAAK,CAAC,QAAQ,IAAI,KAAK,CAAC,IAAI,IAAI,KAAK,CAAC,OAAO,EAAE;gBACjD,OACK,QAAA,CAAA,QAAA,CAAA,EAAA,EAAA,KAAK,CACR,EAAA,EAAA,IAAI,EAAE;AACJ,wBAAA,KAAK,EAAE,MAAM,CAAC,OAAO,CAAC,YAAY;4BAChC,MAAM,CAAC,OAAO,CAAC,YAAY,GAAG,KAAK,CAAC,IAAI,CAAC,KAAK;AAChD,wBAAA,IAAI,EAAE,KAAK,CAAC,IAAI,CAAC,IAAI;AACrB,wBAAA,SAAS,EAAE,MAAM,CAAC,OAAO,CAAC,oBAAoB;AAC5C,4BAAA,IAAI,IAAI,CAAC,IAAI,IAAI,EAAE,CAAC,OAAO,EAAE;gCAC3B,MAAM,CAAC,OAAO,CAAC,oBAAoB,GAAG,EAAE,GAAG,IAAI,CAAC;4BAClD,KAAK,CAAC,IAAI,CAAC,SAAS;AACvB,qBAAA,EACD,OAAO,EAAE;AACP,wBAAA,KAAK,EAAE,MAAM,CAAC,OAAO,CAAC,eAAe;4BACnC,MAAM,CAAC,OAAO,CAAC,eAAe,GAAG,KAAK,CAAC,OAAO,CAAC,KAAK;AACtD,wBAAA,SAAS,EAAE,MAAM,CAAC,OAAO,CAAC,wBAAwB;AAChD,4BAAA,IAAI,IAAI,CAAC,IAAI,IAAI,EAAE,CAAC,OAAO,EAAE;gCAC3B,MAAM,CAAC,OAAO,CAAC,wBAAwB,GAAG,EAAE,GAAG,IAAI,CAAC;4BACtD,KAAK,CAAC,OAAO,CAAC,SAAS;qBAC1B,EACD,SAAS,EAAE,MAAM,CAAC,OAAO,CAAC,gBAAgB;wBACxC,MAAM,CAAC,OAAO,CAAC,gBAAgB,GAAG,KAAK,CAAC,SAAS,EACnD,CAAA,CAAA;AACH,aAAA;AAAM,iBAAA;AACL,gBAAA,OAAO,KAAK,CAAC;AACd,aAAA;AACJ,KAAA;AACH,CAAC;AAED;AACA;;;AAGG;AACG,SAAU,QAAQ,CAAC,YAAiC,EAAA;AACxD,IAAA,QAAQ;QACN,IAAI,EAAE,UAAU,CAAC,MAAM;AACvB,QAAA,OAAO,EAAE,YAAY;AACtB,KAAA,EAAE;AACL,CAAC;AAED;;;AAGG;AACG,SAAU,SAAS,CAAC,iBAA4C,EAAA;AAEpE,IAAA,QAAQ;QACN,IAAI,EAAE,UAAU,CAAC,YAAY;AAC7B,QAAA,OAAO,EAAE,iBAAiB;AAC3B,KAAA,EAAE;AACL,CAAC;AAED;;AAEG;SACa,SAAS,GAAA;AACvB,IAAA,QAAQ;QACN,IAAI,EAAE,UAAU,CAAC,OAAO;AACzB,KAAA,EAAE;AACL;;;;"}